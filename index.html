<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AXON IMPACT GLOBAL</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #2ecc71; --bg-dark: rgba(13, 17, 23, 0.7); --panel: rgba(22, 27, 34, 0.95); --text: #e6edf3; --music: #8a2be2; --video: #1f6feb; --gold: #f1c40f; --orange: #e67e22; }
        body, html { height: 100%; margin: 0; color: var(--text); font-family: 'Segoe UI', sans-serif; background: url('https://i.postimg.cc/pXMzbPsj/20260216-171012-0000.png') no-repeat center center fixed; background-size: cover; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .overlay-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-dark); z-index: 1; }
        .container { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; width: 100%; }
        .app-logo { width: 60%; max-width: 200px; filter: drop-shadow(0 0 15px rgba(46, 204, 113, 0.5)); margin-bottom: -15px; z-index: 3; }
        .panel { background: var(--panel); padding: 25px; border-radius: 30px; width: 85%; max-width: 380px; text-align: center; border: 1px solid rgba(46, 204, 113, 0.3); box-shadow: 0 15px 35px rgba(0,0,0,0.8); backdrop-filter: blur(10px); max-height: 85vh; overflow-y: auto; }
        .btn { display: block; width: 100%; padding: 14px; margin: 8px 0; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; color: white; transition: 0.3s; font-size: 13px; text-transform: uppercase; text-decoration: none; box-sizing: border-box; }
        .btn-green { background: var(--primary); }
        .btn-video { background: var(--video); }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-orange { background: var(--orange); }
        .btn-back { background: #333; font-size: 11px; }
        input, select { width: 100%; background: rgba(13, 17, 23, 0.8); color: white; border: 1px solid #30363d; border-radius: 10px; padding: 12px; margin: 8px 0; box-sizing: border-box; font-size: 14px; }
        .list-container { max-height: 150px; overflow-y: auto; border-radius: 10px; background: rgba(0,0,0,0.5); margin: 10px 0; }
        .list-item { padding: 10px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; font-size: 12px; }
        .screen { display: none; width: 100%; flex-direction: column; align-items: center; }
        #screen1 { display: flex; }
    </style>
</head>
<body>
    <div class="overlay-bg"></div>
    <div class="container">
        <div id="screen1" class="screen">
            <img src="https://i.postimg.cc/pXMzbPsj/20260216-171012-0000.png" class="app-logo">
            <div class="panel">
                <h2 style="color: var(--primary);">AXON IMPACT</h2>
                <button onclick="nav('screenSub')" class="btn btn-green">ENTRAR A MISIONES</button>
            </div>
        </div>

        <div id="screenSub" class="screen">
            <div class="panel">
                <h3 style="color: var(--primary);">REDES SOCIALES</h3>
                <a href="https://t.me/TU_CANAL" target="_blank" class="btn" style="background:#0088cc;">Telegram</a>
                <a href="https://youtube.com/@TU_CANAL" target="_blank" class="btn" style="background:#ff0000;">YouTube</a>
                <label style="display:block; margin:15px 0; font-size:11px;">
                    <input type="checkbox" id="checkSub" onclick="validarSub()"> Ya me suscrib√≠
                </label>
                <button id="btnM" onclick="nav('screenMenu')" class="btn btn-green" style="opacity:0.3; pointer-events:none;">CONTINUAR</button>
            </div>
        </div>

        <div id="screenMenu" class="screen">
            <div class="panel">
                <h3 style="margin:0;">MISIONES ü¶¥</h3>
                <button onclick="nav('folderVideo')" class="btn btn-video">üìπ VER VIDEOS</button>
                <button onclick="irAAfiliados()" class="btn btn-green">üë• AFILIADOS</button>
                <button onclick="checkRegistroCobro()" class="btn btn-gold">üí∞ COBRAR GANANCIAS</button>
                <button onclick="nav('folderDonarG')" class="btn btn-orange">üéÅ DONAR GANANCIAS</button>
                <button onclick="mostrarMiLink()" class="btn" style="background:#34495e;">üîó COPIAR MI LINK</button>
                <p style="font-size: 18px; font-weight: bold;">SALDO: <span id="coinCount" style="color:var(--primary)">0</span> ü¶¥</p>
            </div>
        </div>

        <div id="screenRegistro" class="screen">
            <div class="panel">
                <h2 style="color: var(--gold);">VERIFICACI√ìN</h2>
                <input type="text" id="regName" placeholder="Nombre de Usuario">
                <input type="text" id="regID" placeholder="DNI / C√©dula">
                <select id="regCountry">
                    <option value="Colombia">Colombia</option>
                    <option value="Venezuela">Venezuela</option>
                    <option value="Otro">Otro</option>
                </select>
                <button onclick="finalizarRegistro()" class="btn btn-green">REGISTRAR</button>
                <button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button>
            </div>
        </div>

        <div id="folderAfiliados" class="screen">
            <div class="panel">
                <h3>MIS AFILIADOS</h3>
                <h2 id="numAfiliados" style="color: var(--primary); font-size: 45px;">0</h2>
                <button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button>
            </div>
        </div>

        <div id="folderDonarG" class="screen">
            <div class="panel">
                <h3>DONADORES</h3>
                <button onclick="donarSaldo()" class="btn btn-orange">DONAR TODO</button>
                <div class="list-container" id="listaDonadores"></div>
                <button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button>
            </div>
        </div>

        <div id="folderVideo" class="screen">
            <div class="panel">
                <h3>MISI√ìN VIDEO</h3>
                <button onclick="sumarPuntos(10)" class="btn btn-video">VER (+10 ü¶¥)</button>
                <button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button>
            </div>
        </div>
    </div>

    <script>
        // TUS CREDENCIALES CONFIGURADAS
        const SUPABASE_URL = 'https://ywkcnxhlptqagwxjnygx.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_Pp5vR4_C_8FPhgrFItKpPQ_gt6f6z3k';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let coins = 0;
        let isRegistered = false;
        let userName = "An√≥nimo";
        const urlParams = new URLSearchParams(window.location.search);
        const refPor = urlParams.get('ref');

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
            if(id === 'folderDonarG') cargarDonadores();
        }

        function validarSub() {
            const check = document.getElementById('checkSub').checked;
            document.getElementById('btnM').style.opacity = check ? 1 : 0.3;
            document.getElementById('btnM').style.pointerEvents = check ? 'auto' : 'none';
        }

        function sumarPuntos(pts) {
            coins += pts;
            document.getElementById('coinCount').innerText = coins;
            alert("Ganaste 10 monedas");
            nav('screenMenu');
        }

        function checkRegistroCobro() {
            if (!isRegistered) nav('screenRegistro');
            else alert("Solicitud en tr√°mite.");
        }

        async function finalizarRegistro() {
            const n = document.getElementById('regName').value;
            const d = document.getElementById('regID').value;
            const p = document.getElementById('regCountry').value;
            if (n && d) {
                const { error } = await _supabase.from('usuarios_registrados').insert([{ nombre_usuario: n, documento_id: d, pais: p, monedas: coins, referido_por: refPor }]);
                if (error) alert("Error: Usuario ya existe.");
                else { isRegistered = true; userName = n; alert("Registrado con √©xito"); nav('screenMenu'); }
            }
        }

        function mostrarMiLink() {
            if (!isRegistered) { alert("Reg√≠strate primero."); return; }
            const link = window.location.origin + window.location.pathname + "?ref=" + userName;
            navigator.clipboard.writeText(link);
            alert("Link copiado: " + link);
        }

        async function irAAfiliados() {
            if (!isRegistered) { alert("Reg√≠strate primero."); return; }
            const { count } = await _supabase.from('usuarios_registrados').select('*', { count: 'exact', head: true }).eq('referido_por', userName);
            document.getElementById('numAfiliados').innerText = count || 0;
            nav('folderAfiliados');
        }

        async function donarSaldo() {
            if (coins <= 0) return;
            await _supabase.from('historial_donaciones').insert([{ nombre_usuario: userName, monto: coins }]);
            coins = 0;
            document.getElementById('coinCount').innerText = "0";
            alert("¬°Donaci√≥n recibida!");
            cargarDonadores();
        }

        async function cargarDonadores() {
            const { data } = await _supabase.from('historial_donaciones').select('*').order('fecha', { ascending: false }).limit(5);
            const l = document.getElementById('listaDonadores');
            l.innerHTML = "";
            data?.forEach(d => { l.innerHTML += `<div class="list-item"><span>${d.nombre_usuario}</span><span>${d.monto} ü¶¥</span></div>`; });
        }
    </script>
</body>
</html>

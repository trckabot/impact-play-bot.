<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AXON IMPACT GLOBAL</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root { --primary: #2ecc71; --bg-dark: rgba(13, 17, 23, 0.9); --panel: rgba(22, 27, 34, 0.98); --text: #e6edf3; --music: #8a2be2; --video: #1f6feb; --gold: #f1c40f; --orange: #e67e22; }
        body, html { height: 100%; margin: 0; color: var(--text); font-family: 'Segoe UI', sans-serif; background: url('https://i.postimg.cc/pXMzbPsj/20260216-171012-0000.png') no-repeat center center fixed; background-size: cover; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .overlay-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-dark); z-index: 1; }
        .container { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; width: 100%; }
        .panel { background: var(--panel); padding: 25px; border-radius: 30px; width: 85%; max-width: 380px; text-align: center; border: 1px solid rgba(46, 204, 113, 0.3); box-shadow: 0 15px 35px rgba(0,0,0,0.8); backdrop-filter: blur(10px); max-height: 85vh; overflow-y: auto; }
        .btn { display: block; width: 100%; padding: 14px; margin: 10px 0; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; color: white; transition: 0.3s; font-size: 13px; text-transform: uppercase; text-decoration: none; }
        .btn-green { background: var(--primary); }
        .btn-video { background: var(--video); }
        .btn-music { background: var(--music); }
        .btn-back { background: #333; font-size: 11px; margin-top: 15px; }
        .screen { display: none; width: 100%; flex-direction: column; align-items: center; }
        #video-placeholder { width: 100%; aspect-ratio: 16/9; border-radius: 15px; margin-bottom: 10px; background: #000; }
        .balance-card { background: rgba(46, 204, 113, 0.1); border-radius: 15px; padding: 15px; margin-top: 15px; border: 1px dashed var(--primary); }
    </style>
</head>
<body>
    <div class="overlay-bg"></div>
    <div class="container">
        
        <div id="screenStart" class="screen" style="display: flex;">
            <img src="https://i.postimg.cc/pXMzbPsj/20260216-171012-0000.png" style="width:180px; border-radius:20px; margin-bottom:15px;">
            <div class="panel">
                <h2 style="color: var(--primary);">AXON IMPACT</h2>
                <p>Ayuda a personas y animales mediante la viralidad Blockchain.</p>
                <button onclick="nav('screenMenu')" class="btn btn-green">ENTRAR A MISIONES</button>
            </div>
        </div>

        <div id="screenMenu" class="screen">
            <div class="panel">
                <h3>MISIONES VIRALES ü¶¥</h3>
                <button onclick="cargarMision('wC_sOpQjvWE', 10, 'Video Beele')" class="btn btn-video">üìπ VER VIDEO Y APOYAR</button>
                <button onclick="cargarMision('HL9VoQ-er_U', 5, 'M√∫sica Beele')" class="btn btn-music">üéµ ESCUCHAR Y APOYAR</button>
                
                <div class="balance-card">
                    <span style="font-size: 12px;">SALDO</span>
                    <div style="font-size: 26px; font-weight: bold; color: var(--primary);"><span id="coinCount">0</span> ü¶¥</div>
                </div>
            </div>
        </div>

        <div id="screenPlayer" class="screen">
            <div class="panel">
                <h3 id="misionTitle">Misi√≥n en curso</h3>
                <div id="video-placeholder"></div>
                <p style="font-size: 11px; color: var(--gold);">‚ö†Ô∏è ¬°Dale LIKE y SUSCR√çBETE en YouTube! Si adelantas el video, se reiniciar√°.</p>
                <button onclick="pararMision()" class="btn btn-back">CANCELAR MISI√ìN</button>
            </div>
        </div>

    </div>

    <script>
        let player;
        let lastTime = 0;
        let currentPoints = 0;
        let coins = 0;
        const msgs = [
            "¬°Incre√≠ble! Cada huesito ayuda a un animal sin hogar. üêæ",
            "¬°Misi√≥n cumplida! Est√°s cambiando vidas. ‚ú®"
        ];

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
        }

        // CARGAR EL VIDEO DE YOUTUBE
        function cargarMision(videoId, pts, titulo) {
            currentPoints = pts;
            document.getElementById('misionTitle').innerText = titulo;
            nav('screenPlayer');

            if (player) {
                player.loadVideoById(videoId);
            } else {
                player = new YT.Player('video-placeholder', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { 'autoplay': 1, 'controls': 1, 'rel': 0, 'modestbranding': 1 },
                    events: {
                        'onStateChange': onPlayerStateChange
                    }
                });
            }
            lastTime = 0;
            iniciarChequeoAntitrampa();
        }

        // SISTEMA ANTITRAMPA: Detecta si intenta adelantar
        function iniciarChequeoAntitrampa() {
            const check = setInterval(() => {
                if (!player || typeof player.getCurrentTime !== 'function') return;
                
                let currentTime = player.getCurrentTime();
                
                // Si el usuario adelanta m√°s de 2 segundos respecto al tiempo registrado
                if (currentTime > lastTime + 2.5) {
                    player.seekTo(lastTime);
                    alert("‚ö†Ô∏è No puedes adelantar. Ayuda a la causa viendo el video completo.");
                } else {
                    lastTime = currentTime;
                }

                if (document.getElementById('screenPlayer').style.display === 'none') {
                    clearInterval(check);
                }
            }, 1000);
        }

        function onPlayerStateChange(event) {
            // Cuando el video termina (Estado 0)
            if (event.data === YT.PlayerState.ENDED) {
                coins += currentPoints;
                document.getElementById('coinCount').innerText = coins;
                alert(msgs[Math.floor(Math.random() * msgs.length)]);
                nav('screenMenu');
            }
        }

        function pararMision() {
            if(player) player.stopVideo();
            nav('screenMenu');
        }
    </script>
</body>
</html>

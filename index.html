<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AXON IMPACT GLOBAL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root { 
            --primary: #2ecc71; --panel: #161b22; --text: #e6edf3; 
            --video: #ff0000; --music: #a333c8; --peticiones: #e91e63; 
            --donar: #e67e22; --whatsapp: #25d366; --info: #444; --gold: #fbbd08; 
            --bg-url: url('https://i.postimg.cc/pXMzbPsj/20260216-171012-0000.png');
        }
        body, html { height: 100%; margin: 0; color: var(--text); font-family: 'Segoe UI', sans-serif; background: var(--bg-url) no-repeat center center fixed; background-size: cover; overflow: hidden; }
        .overlay-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1; }
        .container { position: relative; z-index: 2; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .panel { background: var(--panel); padding: 25px; border-radius: 30px; width: 85%; max-width: 400px; text-align: center; border: 2px solid var(--primary); box-shadow: 0 0 25px rgba(46, 204, 113, 0.4); max-height: 85vh; overflow-y: auto; }
        
        .btn { display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; padding: 14px; margin: 10px 0; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; color: white; font-size: 13px; text-transform: uppercase; transition: 0.2s; }
        .btn:disabled { background: #444 !important; opacity: 0.6; cursor: not-allowed; }

        .screen { display: none; flex-direction: column; align-items: center; width: 100%; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .user-card { background: rgba(255,255,255,0.07); padding: 15px; border-radius: 20px; text-align: left; border: 1px solid var(--primary); margin-bottom: 10px; }
        .search-bar { width: 100%; padding: 10px; border-radius: 10px; background: #000; border: 1px solid var(--music); color: white; margin-bottom: 10px; }
        .peticion-card { background: rgba(255,255,255,0.05); margin: 8px 0; padding: 10px; border-radius: 12px; font-size: 12px; border-left: 4px solid var(--peticiones); }
        .advise-box { font-size: 11px; color: var(--gold); background: rgba(0,0,0,0.4); padding: 10px; border-radius: 10px; margin: 10px 0; border: 1px dashed var(--gold); }
    </style>
</head>
<body>
    <div class="overlay-bg"></div>
    <div class="container">
        
        <div id="screenStart" class="screen" style="display: flex;">
            <div style="width: 100%; height: 60vh; background: var(--bg-url) no-repeat center center; background-size: contain; margin-top: -50px;"></div>
            <div class="panel" style="margin-top: -30px;">
                <h2 id="axonTitle" style="color: var(--primary);">AXON IMPACT GLOBAL</h2>
                <p style="font-size: 13px; margin-bottom: 15px;">Ayudando a personas necesitadas y animales de la calle con el poder de Blockchain.</p>
                <button onclick="solicitarRegistro()" class="btn" style="background: var(--primary);">UNIRSE A LA CAUSA</button>
            </div>
        </div>

        <div id="screenMenu" class="screen">
            <div class="panel">
                <div class="user-card">
                    <div style="font-size:14px;"><b>H√©roe:</b> <span id="miNombre">---</span></div>
                    <div style="font-size:11px; color: var(--gold);"><i class="fa-solid fa-heart"></i> Donado: <span id="ptsDonados">0</span> ü¶¥</div>
                    <div style="font-size:11px; color: var(--primary);"><i class="fa-solid fa-wallet"></i> Saldo: <span id="totalCoins">0</span> ü¶¥</div>
                    <div style="font-size:10px; margin-top:5px; color: #888;"><i class="fa-solid fa-earth-americas"></i> Pa√≠s: <span id="userCountry">Detectando...</span></div>
                </div>

                <button onclick="nav('screenVideoList')" class="btn" style="background: var(--video);"><i class="fa-solid fa-play"></i> MISIONES V√çDEO</button>
                <button onclick="nav('screenMusic')" class="btn" style="background: var(--music);"><i class="fa-solid fa-music"></i> CARPETA M√öSICA</button>
                <button onclick="nav('screenDonar')" class="btn" style="background: var(--donar);"><i class="fa-solid fa-heart"></i> DONAR MIS ü¶¥</button>
                <button onclick="compartirReferido()" class="btn" style="background: #0088cc;"><i class="fa-solid fa-share-nodes"></i> INVITAR AMIGOS</button>
            </div>
        </div>

        <div id="screenPlayer" class="screen">
            <div class="panel">
                <h3 id="misionTitle" style="font-size:14px; color:var(--gold);">---</h3>
                <div id="video-placeholder" style="width:100%; aspect-ratio:16/9; border-radius:15px; background:#000;"></div>
                
                <button id="btnYoutube" class="btn" style="background: #ff0000;"><i class="fa-brands fa-youtube"></i> ABRIR YOUTUBE</button>
                
                <div class="advise-box">Abre YouTube, dale like y comenta. Sube tu screenshot; una IA rectificar√° la imagen.</div>
                
                <label for="fileProof" id="btnUpload" class="btn" style="background:var(--gold); color:black; display:none;">
                    <i class="fa-solid fa-camera"></i> SUBIR SCREENSHOT
                </label>
                <input type="file" id="fileProof" accept="image/*" onchange="verificarIA()" style="display:none;">
                
                <button onclick="nav('screenMenu')" class="btn" style="background:#333;">VOLVER</button>
            </div>
        </div>

        <div id="screenMusic" class="screen">
            <div class="panel">
                <h3 style="color:var(--music)">M√öSICA & PETICIONES</h3>
                <input type="text" id="musicSearch" class="search-bar" placeholder="Buscar artista o canci√≥n..." onkeyup="buscarMusica()">
                <div id="musicContainer" style="max-height: 120px; overflow-y: auto; margin-bottom: 15px;"></div>
                
                <div style="border-top: 1px solid #333; padding-top: 10px;">
                    <p style="font-size:11px;">Pide tu canci√≥n (Artista - Nombre):</p>
                    <input type="text" id="musicRequestInput" class="search-bar" style="border-color: var(--peticiones);">
                    <button onclick="enviarPeticionDB()" class="btn" style="background:var(--peticiones);">ENVIAR PEDIDO</button>
                </div>
                <button onclick="nav('screenMenu')" class="btn" style="background:#333;">VOLVER</button>
            </div>
        </div>

        <div id="screenAdmin" class="screen">
            <div class="panel">
                <h3 style="color:var(--gold)">ADMINISTRACI√ìN</h3>
                <div id="statsPaises" style="background:rgba(0,0,0,0.5); padding:10px; border-radius:10px; font-size:12px; margin-bottom:10px;"></div>
                <div id="adminPeticiones" style="text-align:left; font-size:11px;"></div>
                <button onclick="nav('screenMenu')" class="btn" style="background:#333;">CERRAR</button>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIGURACI√ìN EDITABLE ---
        const VALORES = {
            mision_rescate: 500,
            mision_social: 300,
            valor_punto_usd: 0.001 // Ecuaci√≥n: Pago = Puntos * Valor
        };

        const SUPABASE_URL = 'https://ywkcnxhlptqagwxjnygx.supabase.co', SUPABASE_KEY = 'sb_publishable_Pp5vR4_C_8FPhgrFItKpPQ_gt6f6z3k';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let coins = 0, donados = 0, player = null, currentPts = 0, clickCount = 0;
        let miID = localStorage.getItem('miID') || "AX-" + Math.floor(Math.random()*900000);
        let nombre = localStorage.getItem('axon_nombre') || "---";
        let userCountry = "Desconocido";

        // --- DETECCI√ìN DE PA√çS ---
        async function detectarPais() {
            try {
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                userCountry = data.country_name;
                document.getElementById('userCountry').innerText = userCountry;
            } catch(e) { console.error("Error IP"); }
        }

        // --- MANEJO DE V√çDEO (ANTIFRAUDE) ---
        function abrirMision(id, titulo, pts, ytLink) {
            currentPts = pts;
            document.getElementById('misionTitle').innerText = titulo;
            document.getElementById('btnYoutube').onclick = () => window.open(ytLink, '_blank');
            document.getElementById('btnUpload').style.display = 'none';
            nav('screenPlayer');

            if(player) player.destroy();
            player = new YT.Player('video-placeholder', {
                videoId: id,
                playerVars: { 'controls': 0, 'disablekb': 1, 'modestbranding': 1 },
                events: {
                    'onStateChange': (e) => {
                        if(e.data === YT.PlayerState.ENDED) {
                            document.getElementById('btnUpload').style.display = 'flex';
                        }
                    }
                }
            });
        }

        // --- M√öSICA ---
        const listaMusica = [
            { t: "Artista 1 - Cancion A", link: "#" },
            { t: "Artista 2 - Cancion B", link: "#" }
        ];

        function buscarMusica() {
            const q = document.getElementById('musicSearch').value.toLowerCase();
            const c = document.getElementById('musicContainer');
            c.innerHTML = '';
            listaMusica.filter(m => m.t.toLowerCase().includes(q)).forEach(m => {
                c.innerHTML += `<div class="peticion-card" onclick="window.open('${m.link}')">üéµ ${m.t}</div>`;
            });
        }

        async function enviarPeticionDB() {
            const txt = document.getElementById('musicRequestInput').value;
            if(txt.length < 5) return;
            await supabaseClient.from('peticiones').insert([{ usuario: nombre, pedido: txt }]);
            Swal.fire("Enviado", "Pedido recibido por el admin", "success");
            document.getElementById('musicRequestInput').value = "";
        }

        // --- REFERIDOS MULTIPLATAFORMA ---
        function compartirReferido() {
            const msg = `¬°√önete a AXON IMPACT GLOBAL! Ayuda a animales y personas sin hogar. Usa mi ID: ${miID}`;
            if (navigator.share) {
                navigator.share({ title: 'AXON IMPACT', text: msg, url: window.location.href });
            } else {
                window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`);
            }
        }

        // --- ADMINISTRACI√ìN ---
        async function verAdmin() {
            const { data: users } = await supabaseClient.from('usuarios').select('pais');
            const paises = {};
            users.forEach(u => paises[u.pais] = (paises[u.pais] || 0) + 1);
            
            let html = "<b>Usuarios por Pa√≠s:</b><br>";
            for(let p in paises) html += `${p}: ${paises[p]}<br>`;
            document.getElementById('statsPaises').innerHTML = html;
            nav('screenAdmin');
        }

        // --- FUNCIONES BASE ---
        async function guardar() {
            const d = { usuario_id: miID, nombre: nombre, puntos_misiones: coins, puntos_donados: donados, pais: userCountry };
            localStorage.setItem('miID', miID); localStorage.setItem('axon_nombre', nombre);
            localStorage.setItem('axon_coins', coins);
            try { await supabaseClient.from('usuarios').upsert(d, { onConflict: 'usuario_id' }); } catch(e){}
            updateUI();
        }

        function updateUI() {
            document.getElementById('miNombre').innerText = nombre;
            document.getElementById('totalCoins').innerText = coins;
            document.getElementById('ptsDonados').innerText = donados;
        }

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
            if(id === 'screenVideoList') renderVideos();
        }

        function solicitarRegistro() {
            Swal.fire({ title: 'TU NOMBRE H√âROE', input: 'text', background: '#161b22', color: '#fff' }).then(r => {
                if(r.value) { nombre = r.value; detectarPais().then(() => guardar()); nav('screenMenu'); }
            });
        }

        function renderVideos() {
            const c = document.getElementById('videoListContainer'); c.innerHTML = '';
            [{id:'wC_sOpQjvWE', t:'Rescate Animal', s: VALORES.mision_rescate, l:'#'}].forEach(i => {
                const d = document.createElement('div');
                d.className = "peticion-card";
                d.innerHTML = `<span>${i.t}</span> <b>${i.s} ü¶¥</b>`;
                d.onclick = () => abrirMision(i.id, i.t, i.s, i.l);
                c.appendChild(d);
            });
        }

        function verificarIA() {
            Swal.fire({ title: 'IA ANALIZANDO...', didOpen: () => Swal.showLoading() });
            setTimeout(() => { coins += currentPts; guardar(); Swal.fire('√âXITO', '+'+currentPts+' ü¶¥', 'success'); nav('screenMenu'); }, 2000);
        }

        document.getElementById('axonTitle').onclick = () => { clickCount++; if(clickCount >= 5) { clickCount = 0; Swal.fire({ title: 'ADMIN', input: 'password' }).then(r => { if(r.value === "1234") verAdmin(); }); } };

        window.onload = () => { 
            if(localStorage.getItem('axon_nombre')) { 
                nombre = localStorage.getItem('axon_nombre'); 
                coins = parseInt(localStorage.getItem('axon_coins')) || 0; 
                donados = parseInt(localStorage.getItem('axon_donados')) || 0;
                detectarPais();
                updateUI(); 
                nav('screenMenu'); 
            }
            buscarMusica();
        };
    </script>
</body>
</html>

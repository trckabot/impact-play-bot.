<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AXON IMPACT GLOBAL</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #2ecc71; --bg-dark: rgba(13, 17, 23, 0.85); --panel: rgba(22, 27, 34, 0.95); --text: #e6edf3; --music: #8a2be2; --video: #1f6feb; --gold: #f1c40f; --orange: #e67e22; --game: #e74c3c; --task: #3498db; }
        body, html { height: 100%; margin: 0; color: var(--text); font-family: 'Segoe UI', sans-serif; background: url('https://i.postimg.cc/pXMzbPsj/20260216-171012-0000.png') no-repeat center center fixed; background-size: cover; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .overlay-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-dark); z-index: 1; }
        .container { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; width: 100%; }
        .app-logo { width: 70%; max-width: 250px; filter: drop-shadow(0 0 15px rgba(46, 204, 113, 0.5)); margin-bottom: 10px; border-radius: 20px; }
        .panel { background: var(--panel); padding: 25px; border-radius: 30px; width: 85%; max-width: 380px; text-align: center; border: 1px solid rgba(46, 204, 113, 0.3); box-shadow: 0 15px 35px rgba(0,0,0,0.8); backdrop-filter: blur(10px); max-height: 85vh; overflow-y: auto; }
        .btn { display: block; width: 100%; padding: 14px; margin: 10px 0; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; color: white; transition: 0.3s; font-size: 14px; text-transform: uppercase; text-decoration: none; box-sizing: border-box; }
        .btn-green { background: var(--primary); box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4); }
        .btn-video { background: var(--video); }
        .btn-music { background: var(--music); }
        .btn-game { background: var(--game); }
        .btn-task { background: var(--task); }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-orange { background: var(--orange); }
        .btn-back { background: #333; font-size: 11px; }
        input, select { width: 100%; background: rgba(13, 17, 23, 0.8); color: white; border: 1px solid #30363d; border-radius: 10px; padding: 12px; margin: 8px 0; box-sizing: border-box; font-size: 14px; }
        .screen { display: none; width: 100%; flex-direction: column; align-items: center; }
        #screenStart { display: flex; }
        .welcome-text { font-size: 16px; line-height: 1.4; margin: 15px 0; color: #fff; }
        .list-item { padding: 10px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; font-size: 12px; }
    </style>
</head>
<body>
    <div class="overlay-bg"></div>
    <div class="container">
        
        <div id="screenStart" class="screen">
            <img src="https://i.postimg.cc/pXMzbPsj/20260216-171012-0000.png" class="app-logo">
            <div class="panel">
                <h2 style="color: var(--primary); margin-top: 0;">AXON IMPACT GLOBAL</h2>
                <p class="welcome-text">
                    Ayudando a personas necesitadas y animales de la calle con el poder de Blockchain.
                </p>
                <button onclick="nav('screenSub')" class="btn btn-green">ENTRAR A MISIONES</button>
            </div>
        </div>

        <div id="screenSub" class="screen">
            <div class="panel">
                <h3 style="color: var(--primary);">ACTIVA TU CUENTA</h3>
                <p style="font-size: 12px;">Suscr铆bete para empezar a generar impacto.</p>
                <a href="#" class="btn" style="background:#0088cc;">Canal Telegram</a>
                <label style="display:block; margin:20px 0; font-size: 13px;">
                    <input type="checkbox" id="checkSub"> He completado la suscripci贸n
                </label>
                <button onclick="verificarSub()" class="btn btn-green">CONTINUAR</button>
            </div>
        </div>

        <div id="screenMenu" class="screen">
            <div class="panel">
                <h3 style="margin:0 0 10px 0;">MISIONES ACTIVAS Υ</h3>
                <button onclick="nav('folderVideo')" class="btn btn-video"> VIDEOS</button>
                <button onclick="nav('folderMusic')" class="btn btn-music"> MSICA</button>
                <button onclick="nav('folderGames')" class="btn btn-game"> JUEGOS</button>
                <button onclick="nav('folderTasks')" class="btn btn-task"> TAREAS</button>
                <hr style="border: 0.5px solid #333; margin: 15px 0;">
                <button onclick="irAAfiliados()" class="btn btn-green"> AFILIADOS ACTIVOS</button>
                <button onclick="checkRegistroCobro()" class="btn btn-gold"> COBRAR GANANCIAS</button>
                <button onclick="nav('screenDonar')" class="btn btn-orange"> DONAR A LA CAUSA</button>
                <button onclick="mostrarMiLink()" class="btn" style="background:#34495e;"> MI LINK DE INVITADO</button>
                <p style="font-size: 22px; font-weight: bold; margin-top: 15px;">SALDO: <span id="coinCount" style="color:var(--primary)">0</span> Υ</p>
            </div>
        </div>

        <div id="folderVideo" class="screen"><div class="panel"><h3>Misi贸n Video</h3><p>Mira un video para ayudar.</p><button onclick="sumarPuntos(10)" class="btn btn-video">VER AHORA (+10 Υ)</button><button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button></div></div>
        <div id="folderMusic" class="screen"><div class="panel"><h3>Misi贸n M煤sica</h3><p>Escucha y genera impacto.</p><button onclick="sumarPuntos(5)" class="btn btn-music">ESCUCHAR (+5 Υ)</button><button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button></div></div>
        <div id="folderGames" class="screen"><div class="panel"><h3>Misi贸n Juegos</h3><p>Juega por una buena causa.</p><button onclick="sumarPuntos(15)" class="btn btn-game">JUGAR (+15 Υ)</button><button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button></div></div>
        <div id="folderTasks" class="screen"><div class="panel"><h3>Misi贸n Tareas</h3><p>Completa tareas diarias.</p><button onclick="sumarPuntos(20)" class="btn btn-task">COMPLETAR (+20 Υ)</button><button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button></div></div>

        <div id="screenRegistro" class="screen">
            <div class="panel">
                <h2 style="color: var(--gold);">DATOS DE COBRO</h2>
                <input type="text" id="regName" placeholder="Nombre de Usuario">
                <input type="text" id="regID" placeholder="Documento ID / C茅dula">
                <select id="regCountry">
                    <option value="Colombia">Colombia</option>
                    <option value="Venezuela">Venezuela</option>
                    <option value="Espa帽a">Espa帽a</option>
                    <option value="Otro">Otro</option>
                </select>
                <button onclick="finalizarRegistro()" class="btn btn-green">VERIFICAR Y REGISTRAR</button>
                <button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button>
            </div>
        </div>

        <div id="screenDonar" class="screen">
            <div class="panel">
                <h3 style="color: var(--orange);">MURO DE DONACIONES わ</h3>
                <button onclick="donarSaldo()" class="btn btn-orange">DONAR MI SALDO ACTUAL</button>
                <div id="listaDonadores" style="margin-top: 15px; text-align: left;"></div>
                <button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button>
            </div>
        </div>

        <div id="folderAfiliados" class="screen">
            <div class="panel">
                <h3>TU RED DE AYUDA</h3>
                <h2 id="numAfiliados" style="color: var(--primary); font-size: 50px; margin: 10px 0;">0</h2>
                <p style="font-size: 12px;">Personas ayudando gracias a tu invitaci贸n.</p>
                <button onclick="nav('screenMenu')" class="btn btn-back">VOLVER</button>
            </div>
        </div>

    </div>

    <script>
        const SUPABASE_URL = 'https://ywkcnxhlptqagwxjnygx.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_Pp5vR4_C_8FPhgrFItKpPQ_gt6f6z3k';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let coins = 0;
        let isRegistered = false;
        let userName = "";
        const urlParams = new URLSearchParams(window.location.search);
        const refPor = urlParams.get('ref');

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
            if(id === 'screenDonar') cargarDonadores();
        }

        function verificarSub() {
            if(document.getElementById('checkSub').checked) nav('screenMenu');
            else alert("Por favor, confirma tu suscripci贸n.");
        }

        function sumarPuntos(pts) {
            coins += pts;
            document.getElementById('coinCount').innerText = coins;
            alert("Has ganado " + pts + " monedas.");
            nav('screenMenu');
        }

        function checkRegistroCobro() {
            if (!isRegistered) nav('screenRegistro');
            else alert("Tu solicitud est谩 en revisi贸n legal.");
        }

        async function finalizarRegistro() {
            const n = document.getElementById('regName').value;
            const d = document.getElementById('regID').value;
            const p = document.getElementById('regCountry').value;
            if (n && d) {
                const { error } = await _supabase.from('usuarios_registrados').insert([{ nombre_usuario: n, documento_id: d, pais: p, monedas: coins, referido_por: refPor }]);
                if (error) alert("Este usuario o DNI ya existe.");
                else { isRegistered = true; userName = n; alert("隆Registro completado con 茅xito!"); nav('screenMenu'); }
            } else alert("Rellena los campos obligatorios.");
        }

        function mostrarMiLink() {
            if (!isRegistered) { alert("Reg铆strate primero para generar tu link."); return; }
            const link = window.location.origin + window.location.pathname + "?ref=" + userName;
            navigator.clipboard.writeText(link);
            alert("Link copiado: " + link);
        }

        async function irAAfiliados() {
            if (!isRegistered) { alert("Reg铆strate para ver tu red."); return; }
            const { count } = await _supabase.from('usuarios_registrados').select('*', { count: 'exact', head: true }).eq('referido_por', userName);
            document.getElementById('numAfiliados').innerText = count || 0;
            nav('folderAfiliados');
        }

        async function donarSaldo() {
            if (coins <= 0) { alert("No tienes saldo para donar."); return; }
            await _supabase.from('historial_donaciones').insert([{ nombre_usuario: isRegistered ? userName : "An贸nimo", monto: coins }]);
            coins = 0;
            document.getElementById('coinCount').innerText = "0";
            alert("隆Donaci贸n registrada! Gracias por ayudar.");
            cargarDonadores();
        }

        async function cargarDonadores() {
            const { data } = await _supabase.from('historial_donaciones').select('*').order('fecha', { ascending: false }).limit(5);
            const l = document.getElementById('listaDonadores');
            l.innerHTML = "<strong>Donadores Recientes:</strong>";
            data?.forEach(d => { l.innerHTML += `<div class="list-item"><span>${d.nombre_usuario}</span><span>${d.monto} Υ</span></div>`; });
        }
    </script>
</body>
</html>
